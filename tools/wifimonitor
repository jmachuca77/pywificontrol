#!/usr/bin/python

import signal
from wificontrol import WiFiMonitor, WiFiControl


def main():
    
    wifi_monitor = WiFiMonitor()

    def handler(signum, frame):
        wifi_monitor.shutdown()

    def print_wifi_state():
        print(WiFiControl().get_status())

    wifi_monitor.register_callback(wifi_monitor.HOST_STATE, print_wifi_state)
    wifi_monitor.register_callback(wifi_monitor.CLIENT_STATE, print_wifi_state)
    wifi_monitor.register_callback(wifi_monitor.OFF_STATE, print_wifi_state)
    wifi_monitor.register_callback(wifi_monitor.SCAN_STATE, print_wifi_state)
    wifi_monitor.register_callback(wifi_monitor.REVERT_EVENT, print_wifi_state)
    wifi_monitor.register_callback(wifi_monitor.SUCCESS_EVENT, print_wifi_state)

    signal.signal(signal.SIGINT, handler)
    signal.signal(signal.SIGTERM, handler)

    wifi_monitor.run()


if __name__ == '__main__':
    main()
